<source>
  @type forward
  @id input_forward
</source>

<match app1.**>
  @type copy
  <store>
    @type file
    @id outfileapp1
    path /tmp/task05/app1/${tag[3]}.${tag[4]}
    path_suffix ""
    append true
    <buffer tag>
      timekey 1m
    </buffer>
  </store>

  <store>
  @type s3

  aws_key_id AKIAZMJMH6DA556XP7FK
  aws_sec_key aBevX3+XqNF1leSSIQdyr2hOSEln5eCIsfIDcCDU
  s3_bucket 329bd30c94eb606a0e123c5b6c0768f0
  s3_region eu-central-1
  path task05/app1/${tag[1]}/${tag[2]}/${tag[3]}

  <buffer tag,time>
    @type file
    path /tmp/s3/app1
    timekey 3600 # 1 hour partition
    timekey_wait 10m
    timekey_use_utc true # use utc
    chunk_limit_size 256m
  </buffer>

  </store>
</match>

<match app2.**>
  @type copy
  <store>
    @type file
    @id outfileapp2

    path /tmp/task05/app2/${tag[3]}.${tag[4]}
    path_suffix ""
    append true
    <buffer tag>
      timekey 1m
    </buffer>
  </store>

  <store>
  @type s3

  aws_key_id AKIAZMJMH6DA556XP7FK
  aws_sec_key aBevX3+XqNF1leSSIQdyr2hOSEln5eCIsfIDcCDU
  s3_bucket 329bd30c94eb606a0e123c5b6c0768f0
  s3_region eu-central-1
  path task05/app2/${tag[1]}/${tag[2]}/${tag[3]}

  <buffer tag,time>
    @type file
    path /tmp/s3/app2
    timekey 3600 # 1 hour partition
    timekey_wait 10m
    timekey_use_utc true # use utc
    chunk_limit_size 256m
  </buffer>

  </store>
</match>